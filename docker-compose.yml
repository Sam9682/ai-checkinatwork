version: '3.8'

services:
  app:
    build: .
    ports:
      - "${HTTP_PORT:-6500}:5000"
    container_name: ai-checkinatwork-app-${USER_ID:-1}-${HTTP_PORT:-6000}
    environment:
      FLASK_ENV: production
      SECRET_KEY: ${SECRET_KEY:-checkin-secret-key}
    volumes:
      - ./data:/app/data
      - ./templates:/app/templates
      - ./static:/app/static
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "${HTTPS_PORT:-6501}:443"
    container_name: ai-checkinatwork-nginx-${USER_ID:-1}-${HTTPS_PORT:-6000}
    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl/fullchain.pem:/etc/nginx/ssl/fullchain.pem:ro
      - ./ssl/privkey.pem:/etc/nginx/ssl/privkey.pem:ro
    depends_on:
      - app
    restart: unless-stopped

volumes:
  data: